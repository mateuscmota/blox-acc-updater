(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},APP_ID:{key:"appId",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:25}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},SLIDE_ALL:{key:"slide_all",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},HCAPTCHA:{key:"hcaptcha",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},CLOUDFLARE:{key:"cloudflare",defaultValue:{delayClick:2e3,isActive:!0}},TENCENT:{key:"tencent",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}}},t=async(e,t)=>{const a="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,r="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const i=await a.get([e]);if(r.lastError)throw new Error(`Error retrieving ${e}: ${r.lastError.message}`);return null!=i[e]?i[e]:t}catch(e){throw e}};Promise.resolve();async function a(e,t,a){const r="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((i,n)=>{r.sendMessage({source:e,type:t,data:a},(e=>{r.lastError?n(new Error(`Error sending message: ${r.lastError.message}`)):i(e)}))}))}catch(e){throw e}}async function r(e){return new Promise((t=>setTimeout(t,e)))}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r="1.5.6";let i=document.getElementById("captcha-message");i||(i=document.createElement("div"),i.id="captcha-message",i.style.zIndex="99999999",i.style.padding="3px 3px",i.style.borderRadius="3px",i.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.2)",i.style.fontSize="10px",i.style.fontWeight="600",i.style.fontFamily="Arial, sans-serif",i.style.textAlign="center",i.style.whiteSpace="nowrap",i.style.color="white",i.style.top="1px",a&&a.parentElement?(i.style.position="absolute",i.style.left="2px",a.parentElement.appendChild(i)):(i.style.position="fixed",i.style.left="1px",document.body.appendChild(i)));const n={success:"linear-gradient(90deg, #6a11cb,rgb(191, 37, 252))",error:"linear-gradient(90deg, #ff416c, #ff4b2b)",warning:"linear-gradient(90deg, #ff9a44, #fc6076)",info:"linear-gradient(90deg, #17a2b8, #138496)"};i.innerText=`[OMOcaptcha-${r}] `+e,i.style.background=n[t]||n.success,i.style.display="block"}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{timeout:5e3,maxRetries:3,typeImage:"png"};try{const{timeout:a,maxRetries:i,typeImage:n}=t,c=`image/${n||"png"}`,s={arkoselabs:"image/jpeg"};function o(e){for(const[t,a]of Object.entries(s))if(e.includes(t))return a;return c}if(e instanceof HTMLCanvasElement||e.tagName&&"CANVAS"===e.tagName.toUpperCase())try{if(0===e.width||0===e.height)return"";const l=e.getBoundingClientRect(),u=l.width,d=l.height,f=document.createElement("canvas");f.width=u,f.height=d;f.getContext("2d").drawImage(e,0,0,u,d);const m=f.toDataURL(c).split(",")[1];return m||""}catch(p){return""}if(e instanceof Element)try{const h=e.src;if(h&&h.startsWith("data:image/")){const y=h.split(",")[1];return y||""}e=h||""}catch(g){return""}if("string"==typeof e&&e.startsWith("blob:"))try{return await new Promise((t=>{const a=new Image;a.setAttribute("crossOrigin","anonymous");const r=setTimeout((()=>{t("")}),1e3);a.onload=function(){clearTimeout(r);try{const a=document.createElement("canvas");a.width=this.naturalWidth,a.height=this.naturalHeight;a.getContext("2d").drawImage(this,0,0);const r=o(e);a.toBlob((e=>{if(!e)return void t("");const a=new FileReader;a.onloadend=()=>{const e=a.result.split(",")[1];t(e)},a.onerror=()=>t(""),a.readAsDataURL(e)}),r)}catch(e){t("")}},a.onerror=()=>{clearTimeout(r),t("")},a.src=e}))}catch(w){return""}if("string"==typeof e)try{for(let k=0;k<i;k++)try{const b=new AbortController,v=setTimeout((()=>b.abort()),a),S=await fetch(e,{signal:b.signal});if(clearTimeout(v),!S.ok)throw new Error(`HTTP error ${S.status}`);const T=await S.blob();return await new Promise(((e,t)=>{const a=new FileReader;a.onloadend=()=>e(a.result.split(",")[1]),a.onerror=()=>t(new Error("Failed to read blob as base64")),a.readAsDataURL(T)}))}catch(E){if(k===i-1)return"";await r(500)}}catch(A){return""}return""}catch(I){return""}}function c(e,t){return new Promise((a=>{const r=Date.now(),i=setInterval((()=>{for(const t of e){if(document.querySelector(t))return clearInterval(i),void a(!0)}Date.now()-r>=t&&(clearInterval(i),a(!1))}),500)}))}async function s(e){try{const t=await a("SOURCE","createTask",e);return t||""}catch(e){return""}}async function o(e,t,r){const i=JSON.stringify({clientKey:e,taskId:t});try{const e=await a("SOURCE","getTaskResult",{data:i,timeWait:r});return e?"fail"===e.status?{errorDescription:e.errorDescription}:e.solution?e.solution:e.type?e:null:null}catch(e){return null}}let l,u,d,f,m,p;async function h(){l=await t(e.POWER_ON.key,e.POWER_ON.defaultValue),u=await t(e.API_KEY.key,e.API_KEY.defaultValue);const a=await t(e.TIKTOK.key,e.TIKTOK.defaultValue);d=a.delayClick,f=a.delaySwipe,m=a.loop,p=a.isActive}let y=!1,g="";async function w(){for(;;){await r(500);var e,t="";for(let e=0;e<10&&(e>0&&await r(1e3),null==(t=document.querySelector('img[data-testid="whirl-outer-img"]')));e++);if(e=document.querySelector('img[data-testid="whirl-inner-img"]'),!t||!e)return;i("Found captchaRotate","red",t);var a=null,n=null;for(let i=0;i<10&&(a=t.src,n=e.src,""===a||""===n);i++)await r(1e3);if(""===a||""===n){if(m){document.querySelector('a[class*="secsdk_captcha_refresh RefreshButton" i]').click();continue}return}const l={type:"TiktokRotateWebTask",imageUrls:[a,n]},d=JSON.stringify({clientKey:u,task:l}),f=await s(d);let p="";if(!f||f.error||f.message){if(p=f.error?f.errorDescription:f.message?f.message:"No response createTask",i(p,"red",t),m){document.querySelector('a[class*="secsdk_captcha_refresh RefreshButton" i]').click();continue}return}const h=await o(u,f.taskId,30);if(!h||h.errorDescription){if(i(h?h.errorDescription:"No result from API","red",t),m){document.querySelector('a[class*="secsdk_captcha_refresh RefreshButton" i]').click();continue}return}i("Solving...","red",t);const y=271-271*parseFloat(h.rotate);var c=document.querySelector("#secsdk-captcha-drag-wrapper");await A(c,y),await r(3500);if(document.querySelector('img[data-testid="whirl-outer-img"]')){if(m)continue;return}return}}async function k(){for(;;){await r(500);var e,t="";for(let e=0;e<10&&(e>0&&await r(1e3),null==(t=document.querySelector('[class*="captcha"]>[role="main"] [class*="cap-items-center "] img[class*="[210px]"]'))||M('[class*="captcha"]>[role="main"] [class*="cap-items-center "] img[class*="[210px]"]'));e++);if(e=document.querySelector('[class*="captcha"]>[role="main"] [class*="cap-items-center "] img[class*="[128px]"]'),!t||!e)return;i("Found captchaRotate_new","red",t);var a,c=null,l=null;for(let a=0;a<10&&(a>0&&await r(1e3),c=t.src,l=e.src,""===c||""===l);a++);if(""===c||""===l){if(m){C();continue}return}a=c.startsWith("data:")?{type:"TiktokRotateWebTask",imageBase64s:[c,l]}:c.startsWith("blob:")?{type:"TiktokRotateWebTask",imageBase64s:[await n(c),await n(l)]}:{type:"TiktokRotateWebTask",imageUrls:[c,l]};const p=JSON.stringify({clientKey:u,task:a});i("Create task...","red",t);const h=await s(p);let y="";if(!h||h.error||h.message){if(y=h.error?h.errorDescription:h.message?h.message:"No response createTask",i(y,"red",t),await r(1e3),m){C();continue}return}i("Get result...","red",t);const g=await o(u,h.taskId,30);if(!g||g.errorDescription){if(i(g?g.errorDescription:"No result from API","red",t),m){C();continue}return}var d=document.querySelector('[class*="captcha"]>[role="main"] [class*="absolute"][draggable="true"]');let w=parseFloat(g.rotate);isNaN(w)&&(w=0);var f=parseInt(x(d),10);const k=f-f*w;i("Solving...","red",t),await I(d,k),await r(3500);if(document.querySelector('[class*="captcha"]>[role="main"] [class*="cap-items-center "] img[class*="[210px]"]')){if(m){await r(500);continue}return}return}}async function b(){for(;;){await r(500);let t,a=null,c=null;for(let e=0;e<10&&(e>0&&await r(1e3),a=document.querySelector("#captcha-verify-image"),null===a||null===a.src||""===a.src||a.src===g||(c=a.src,g=c,null==c));e++);if(i("Found captcha slide","red",a),null===c){if(i("image_url = null","red",a),m){document.querySelector('a[class*="secsdk_captcha_refresh"]').click();continue}return}t=c.startsWith("data:")?{type:"TiktokSliderWebTask",imageBase64:c,widthView:a.width}:c.startsWith("blob:")?{type:"TiktokSliderWebTask",imageBase64:await n(c),widthView:a.width}:{type:"TiktokSliderWebTask",imageUrl:c,widthView:a.width};const l=JSON.stringify({clientKey:u,task:t});i("Create task...","red",a);const d=await s(l);let f="";if(!d||d.error||d.message){if(f=d.error?d.errorDescription:d.message?d.message:"No response createTask",i(f,"red",a),m){document.querySelector('a[class*="secsdk_captcha_refresh"]').click();continue}return}i("Get result...","red",a);const p=await o(u,d.taskId,30);if(!p||p.errorDescription){if(i(p?p.errorDescription:"No result from API","red",a),m){document.querySelector('a[class*="secsdk_captcha_refresh"]').click();continue}return}let h=parseInt(p.end.x,10);var e=document.querySelector("#secsdk-captcha-drag-wrapper");i("Solving...","red",a),await D(e,h),await r(3500);if(document.querySelector("#captcha-verify-image")){if(m)continue;return}return}}async function v(){for(;;){await r(500);let a=null,c=null;for(let e=0;e<10;e++)if(e>0&&await r(1e3),a=document.querySelector("#captcha-verify-image"),null!==a&&null!==a.src&&""!==a.src&&a.src!==g&&!M("#captcha-verify-image")){c=a.src,g=c;break}if(i("Found captchaKeoTha_new","red",a),null===c){if(i("image_url = null","red",a),m){C();continue}return}var e;e=c.startsWith("data:")?{type:"TiktokSliderWebTask",imageBase64:c,widthView:a.width}:c.startsWith("blob:")?{type:"TiktokSliderWebTask",imageBase64:await n(c),widthView:a.width}:{type:"TiktokSliderWebTask",imageUrl:c,widthView:a.width};const l=JSON.stringify({clientKey:u,task:e});i("Create task...","red",a);const d=await s(l);let f="";if(!d||d.error||d.message){if(f=d.error?d.errorDescription:d.message?d.message:"No response createTask",i(f,"red",a),m){C();continue}return}i("Get result...","red",a);const p=await o(u,d.taskId,30);if(!p||p.errorDescription){if(i(p?p.errorDescription:"No result from API","red",a),m){C();continue}return}let h=.8*parseInt(p.end.x,10);var t=document.querySelector('[class*="captcha"]>[role="main"] [class*="absolute"][draggable="true"]');i("Solving...","red",a),await _(t,h),await r(3500);if(document.querySelector("#captcha-verify-image")){if(m)continue;return}return}}async function S(){for(;;){await r(500);var e=null;for(let t=0;t<10&&(t>0&&await r(1e3),null==(e=document.querySelector("#captcha-verify-image"))||M('[class*="captcha_verify_container"] img'));t++);if(!e)return;i("Found captcha3D","red",e);var t=null;for(let a=0;a<10&&(a>0&&await r(1e3),!(null!=(t=e.src)&&e.width>0&&e.height>0));a++);if(null===t){if(i("image_url = null","red",e),m){document.querySelector('a[class*="secsdk_captcha_refresh" i]').click();continue}return}const a={type:"Tiktok3DSelectObjectWebTask",imageUrl:t,widthView:e.width,heightView:e.height},n=JSON.stringify({clientKey:u,task:a});i("Create task...","red",e);const c=await s(n);let l="";if(!c||c.error||c.message){if(l=c.error?c.errorDescription:c.message?c.message:"No response createTask",i(l,"red",e),m){document.querySelector('a[class*="secsdk_captcha_refresh" i]').click();continue}return}i("Get result...","red",e);const f=await o(u,c.taskId,30);if(!f||f.errorDescription){if(i(f?f.errorDescription:"No result from API","red",e),m){document.querySelector('a[class*="secsdk_captcha_refresh" i]').click();continue}return}i("Solving...","red",e);let p=parseInt(f.pointA.x,10),h=parseInt(f.pointA.y,10),y=parseInt(f.pointB.x,10),g=parseInt(f.pointB.y,10);q(e,p,h),await r(d),q(e,y,g),await r(d),document.querySelector('div[class*="verify-captcha-submit-button" i]').click(),await r(3500);if(document.querySelector("#captcha-verify-image")){if(m)continue;return}return}}async function T(){let e=null;for(;;){await r(500);let t=null;for(let a=0;a<20;a++)if(a>0&&await r(350),t=document.querySelector('[class*="captcha-verify-container"] img'),t&&!M('[class*="captcha-verify-container"] img')&&t.src!==e&&t.width>50&&t.height>50){e=t.src;break}let a=document.querySelector('[class*="captcha-verify-container"] [class*="cap-min-h-[180px]"]');if(!e){if(i("imageUrl = null","red",a),m){e=null,C();continue}return}let c,l="Solving captcha Tiktok 3D Select";c=e.startsWith("data:")?{type:"Tiktok3DSelectObjectWebTask",imageBase64:e,widthView:t.width,heightView:t.height}:e.startsWith("blob:")?{type:"Tiktok3DSelectObjectWebTask",imageBase64:await n(e,{typeImage:"jpeg"}),widthView:t.width,heightView:t.height}:{type:"Tiktok3DSelectObjectWebTask",imageUrl:e,widthView:t.width,heightView:t.height};let f=null;for(let e=0;e<4&&(e>0&&await r(300),f=document.querySelector('[id*="captcha-verify-container-main-page"] div span'),!f);e++);(c.imageBase64?.length??0)>5e4&&(c.type="TiktokSelectObjectWebTask",c.question=f?f.textContent.trim():"",l="Solving Tiktok Select"),i(l,"red",a);const p=JSON.stringify({clientKey:u,task:c});i("Create task...","red",a);const h=await s(p);let y="";if(!h||h.error||h.message){if(y=h.error?h.errorDescription:h.message?h.message:"No response createTask",i(y,"red",a),m){e=null,C();continue}return}i("Get result...","red",a);const g=await o(u,h.taskId,30);if(!g||g.errorDescription){if(i(g?g.errorDescription:"No result from API","red",a),m){e=null,C();continue}return}let w=parseInt(g.pointA.x,10),k=parseInt(g.pointA.y,10),b=parseInt(g.pointB.x,10),v=parseInt(g.pointB.y,10);i("Clicking...","red",a),q(t,w,k),await r(d),q(t,b,v),await r(d),document.querySelector('[class*="captcha-verify-container"] [class*="cap-relative"] [class="TUXButton-label"]').click(),await r(3500);if(document.querySelector('[class*="captcha-verify-container"] img')){if(i("Solve failed","red",a),m)continue;return}return}}function E(e){return!!document.querySelector(e)}function A(e,t){return new Promise((a=>{var r=new MouseEvent("mousedown",{bubbles:!0});e.dispatchEvent(r);var i=f,n=0;!function r(){n+=1;var c=new MouseEvent("mousemove",{bubbles:!0,clientX:n,clientY:0});if(e.dispatchEvent(c),n<t)setTimeout(r,i);else{var s=new MouseEvent("mouseup",{bubbles:!0});e.dispatchEvent(s),a()}}()}))}function I(e,t){return new Promise((a=>{var r=new DragEvent("dragstart",{bubbles:!0,clientX:0,clientY:8});e.dispatchEvent(r);var i=0,n=f;!function r(){i+=1;var c=new DragEvent("drag",{bubbles:!0,clientX:i,clientY:8});e.dispatchEvent(c),i<t?setTimeout(r,n):setTimeout((()=>{var t=new DragEvent("dragend",{bubbles:!0});e.dispatchEvent(t),a()}),1e3)}()}))}function _(e,t){return new Promise((a=>{let r=0;const i=t+10;function n(t,a){!function i(){const n=t-r;if(Math.abs(n)<.5)return void(a&&a());const c=Math.min(function(e){return e>80?6*Math.random()+6:e>40?4*Math.random()+3:e>15?2*Math.random()+1.5:1*Math.random()+.5}(Math.abs(n)),Math.abs(n));r+=n>0?c:-c,e.dispatchEvent(new DragEvent("drag",{bubbles:!0,clientX:Math.round(r),clientY:8})),setTimeout(i,12*Math.random()+8)}()}e.dispatchEvent(new DragEvent("dragstart",{bubbles:!0,clientX:r,clientY:8})),n(i,(()=>{setTimeout((()=>{n(t,(()=>{setTimeout((()=>{e.dispatchEvent(new DragEvent("dragend",{bubbles:!0,clientX:t,clientY:8})),a()}),120)}))}),80)}))}))}async function D(e,t){return new Promise((a=>{if(!e)return a();const i=new DataTransfer,n=t+10;let c=0,s=0;function o(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,...a})),e.dispatchEvent(new PointerEvent(t,{bubbles:!0,cancelable:!0,pointerType:"mouse",isPrimary:!0,...a}))}function l(e){return e>80?8*Math.random()+6:e>40?5*Math.random()+3:e>15?2*Math.random()+1.5:.8*Math.random()+.4}async function u(e){for(;Math.abs(e-c)>.5;){const t=e-c,a=Math.min(l(Math.abs(t)),Math.abs(t));c+=t>0?a:-a,s+=8*(Math.random()-.5)*.3,o("mousemove",{clientX:c,clientY:s}),o("pointermove",{clientX:c,clientY:s}),await r(12*Math.random()+8)}}(async()=>{o("mouseenter"),o("mouseover"),await r(30),o("pointerdown",{clientX:0,clientY:0}),o("mousedown",{clientX:0,clientY:0}),e.dispatchEvent(new DragEvent("dragstart",{bubbles:!0,cancelable:!0,dataTransfer:i})),await u(n),await r(80*Math.random()+40),await u(t);const c=s;await r(60*Math.random()+60),o("pointerup",{clientX:t,clientY:c}),o("mouseup",{clientX:t,clientY:c}),e.dispatchEvent(new DragEvent("dragend",{bubbles:!0,cancelable:!0,dataTransfer:i})),a()})()}))}function q(e,t,a){var r=e.getBoundingClientRect(),i=r.left+t,n=r.top+a,c=new MouseEvent("click",{bubbles:!0,clientX:i,clientY:n});e.dispatchEvent(c)}function C(){for(var e=document.querySelectorAll('[class*="captcha-verify-container"] button'),t=0;t<e.length;t++){var a=e[t].querySelector('[d*="M56"]');let r=document.querySelector("#captcha_refresh_button");if(a){e[t].click();break}if(r){r.click();break}}}function M(e){const t=document.querySelector(e);return!!t&&("IMG"===t.tagName||"IFRAME"===t.tagName?!t.complete:!!t.classList.contains("loading"))}function x(e){if(!e)return null;const t=e.parentElement;if(!t)return null;return t.clientWidth-e.clientWidth}new MutationObserver((async(e,t)=>{await async function(e){if(await h(),l&&p&&u&&"YOUR_CLIEN_KEY"!==u)for(const t of e)if("childList"===t.type&&document.querySelector('[role="dialog"][class*="captcha"]')&&!y){y=!0,await r(1500);try{if(!await c(['img[data-testid="whirl-outer-img" i]','img[class*="captcha_verify_img_slide" i]','div[class*="verify-captcha-submit-button" i]','[class*="captcha-verify-container"] [class="TUXButton-label"]','[class*="captcha"]>[role="main"] [class*="cap-items-center "] img','[class*="captcha"]>[role="main"] img[class*="cap-w-full cap-h-auto"]'],1e4))continue;for(let e=0;e<30;e++){if(E('img[data-testid="whirl-outer-img" i]')){await w();break}if(E('img[class*="captcha_verify_img_slide" i]')){await b();break}if(E('div[class*="verify-captcha-submit-button" i]')){await S();break}if(E('[class*="captcha"]>[role="main"] [class="cap-flex cap-absolute "][style*="left: 0px;"]')&&2===document.querySelectorAll('[class*="captcha"]>[role="main"] [class*="cap-relative"] img').length){await v();break}if(E('[class*="captcha-verify-container"] [class="TUXButton-label"]')&&"Confirm"===document.querySelector('[class*="captcha-verify-container"] [class="TUXButton-label"]').textContent||E('[class*="captcha"]>[role="main"] img[class*="cap-w-full cap-h-auto"]')){await T();break}if(E('[class*="captcha"]>[role="main"] [class*="cap-items-center "] img')&&document.querySelectorAll('[class*="captcha"]>[role="main"] [class*="cap-items-center "] img').length<3){await k();break}await r(1e3)}}catch(e){i(`Error: ${e.message}`,"red")}finally{y=!1}}}(e)})).observe(document.body,{childList:!0,subtree:!0}),(async()=>{await h()})()})();