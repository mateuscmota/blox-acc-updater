(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},APP_ID:{key:"appId",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:25}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},SLIDE_ALL:{key:"slide_all",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},HCAPTCHA:{key:"hcaptcha",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},CLOUDFLARE:{key:"cloudflare",defaultValue:{delayClick:2e3,isActive:!0}},TENCENT:{key:"tencent",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}}};async function t(e,t,n){const r="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((o,a)=>{r.sendMessage({source:e,type:t,data:n},(e=>{r.lastError?a(new Error(`Error sending message: ${r.lastError.message}`)):o(e)}))}))}catch(e){throw e}}const n=async(e,t)=>{const n="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,r="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const o=await n.get([e]);if(r.lastError)throw new Error(`Error retrieving ${e}: ${r.lastError.message}`);return null!=o[e]?o[e]:t}catch(e){throw e}};Promise.resolve();async function r(e){return new Promise((t=>setTimeout(t,e)))}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r="1.5.6";let o=document.getElementById("captcha-message");o||(o=document.createElement("div"),o.id="captcha-message",o.style.zIndex="99999999",o.style.padding="3px 3px",o.style.borderRadius="3px",o.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.2)",o.style.fontSize="10px",o.style.fontWeight="600",o.style.fontFamily="Arial, sans-serif",o.style.textAlign="center",o.style.whiteSpace="nowrap",o.style.color="white",o.style.top="1px",n&&n.parentElement?(o.style.position="absolute",o.style.left="2px",n.parentElement.appendChild(o)):(o.style.position="fixed",o.style.left="1px",document.body.appendChild(o)));const a={success:"linear-gradient(90deg, #6a11cb,rgb(191, 37, 252))",error:"linear-gradient(90deg, #ff416c, #ff4b2b)",warning:"linear-gradient(90deg, #ff9a44, #fc6076)",info:"linear-gradient(90deg, #17a2b8, #138496)"};o.innerText=`[OMOcaptcha-${r}] `+e,o.style.background=a[t]||a.success,o.style.display="block"}function a(e){["pointerdown","mousedown","mouseup","click"].forEach((function(t){e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window}))}))}async function i(e){try{const n=await t("SOURCE","createTask",e);return n||""}catch(e){return""}}let c,s,l,u,d;(async()=>{await async function(){c=await n(e.POWER_ON.key,e.POWER_ON.defaultValue),s=await n(e.API_KEY.key,e.API_KEY.defaultValue);const t=await n(e.TENCENT.key,e.TENCENT.defaultValue);l=t.delaySwipe,u=t.loop,d=t.isActive}();const t=[{selector:'body[aria-hidden="false"] .tc-captcha.tc-img-select',function:p},{selector:'body[aria-hidden="false"] .tc-captcha .tc-slider-normal',function:m},{selector:'body[aria-hidden="false"] .tc-captcha .tc-opera.pointer',function:y}];let o=!1;async function a(){if(c&&d&&s&&"YOUR_CLIEN_KEY"!==s&&!o)for(const e of t){if(document.querySelector(e.selector)){o=!0;try{await e.function()}catch(e){}finally{o=!1}return}}}(async()=>{for(let e=0;e<110;e++)e>0&&await r(1e3),await a()})();new MutationObserver((()=>{a()})).observe(document.body,{childList:!0,subtree:!0})})();let f="";async function m(){for(;;){let e,n;for(let t=0;t<30;t++){t>0&&await r(500),e=document.querySelector(".tc-captcha #slideBg");const o=document.querySelector(".tc-opera");if(n=o?.querySelectorAll(".tc-fg-item")[1],null!==e)break}if(!e)return;let a=document.querySelector(".tc-captcha");o("Captcha tc-captcha","red",a);let c=null,l=null;for(let t=0;t<20;t++){t>0&&await r(500);const n=getComputedStyle(e);c=n.backgroundImage.match(/url\(["']?(.*?)["']?\)/)?.[1];const o=document.querySelector(".tc-opera"),a=o?.querySelectorAll(".tc-fg-item")[1];if(a){const e=getComputedStyle(a);l=e.backgroundImage.match(/url\(["']?(.*?)["']?\)/)?.[1]}if(c&&"none"!==c&&l&&"none"!==l)break}if(!c||"none"===c)return;if(!l||"none"===l){if(u)continue;return}let d="",m="";for(let e=0;e<20;e++)if(e>0&&await r(500),d=await t("SLIDE_ALL","createImageBase64",{url:c}),m=await t("SLIDE_ALL","createImageBase64",{url:l}),d&&m&&f!==d){f=d;break}const p={type:"SliderAllWebTask",domain:window.location.hostname,imageBase64:d,puzzle:m,widthView:e.clientWidth,heightView:e.clientHeight},y=JSON.stringify({clientKey:s,task:p});o("Create task...","red",a);const h=await i(y);let b="";if(!h||h.error||h.message){if(b=h.error?h.errorDescription:h.message?h.message:"No response createTask",o(b,"red",a),u){document.querySelector(".refreshButton.show .tc-refresh-icon").click();continue}return}o("Get result...","red",a);const E=await g(s,h.taskId,30);if(!E||E.errorDescription){if(o(E?E.errorDescription:"No result from API","red",a),u){document.querySelector(".refreshButton.show .tc-refresh-icon").click(),await r(1e3);continue}return}let v=1;v=parseInt(E.rects[0].x,10);let k=v-25,S=document.querySelector(".tc-fg-item.tc-slider-normal");o("Drag...","red",a),await w(S,k);if(await new Promise((e=>{let t=!1;const n=document.querySelector("#tcWrap"),r=n?.parentElement;if(!r)return void e(!1);const o=new MutationObserver((n=>{for(const a of n)"attributes"===a.type&&"aria-hidden"===a.attributeName&&"true"===r.getAttribute("aria-hidden")&&(t||(t=!0,o.disconnect(),e(!1)))}));o.observe(r,{attributes:!0,attributeFilter:["aria-hidden"]}),setTimeout((()=>{t||(t=!0,o.disconnect(),e(!0))}),4e3)}))){if(u)continue;return}return}}async function p(){for(;;){let e,n;for(let t=0;t<30&&(t>0&&await r(500),e=document.querySelector(".tc-captcha .tc-bg-img.unselectable"),n=document.querySelector(".tc-title .tc-instruction-icon img"),null===e);t++);if(!e)return;let c=document.querySelector(".tc-captcha");o("Captcha tc-captcha","red",c);let l=null,d=null,m=null;for(let t=0;t<20;t++){t>0&&await r(500);const n=getComputedStyle(e);l=n.backgroundImage.match(/url\(["']?(.*?)["']?\)/)?.[1];const o=document.querySelector(".tc-title #instructionText");d=o?.textContent?.trim().replace(/^["']|["']$/g,"")||null;const a=document.querySelector(".tc-title .tc-instruction-icon img");if(m=a?a.src:null,l&&"none"!==l&&d)break}if(!l||"none"===l)return;if(!d)return;let p="",y="";for(let e=0;e<10;e++){e>0&&await r(1e3),p=await t("TENCENT","createImageBase64",{url:l}),m&&(y=await t("TENCENT","createImageBase64",{url:m}));if(!!p&&(!m||!!y)&&f!==p){f=p;break}}const w={type:"TencentSelectObjectTask",imageBase64:p,question:d};y&&(w.anchor=y);const b=JSON.stringify({clientKey:s,task:w});o("Create task...","red",c);const E=await i(b);let v="";if(!E||E.error||E.message){if(v=E.error?E.errorDescription:E.message?E.message:"No response createTask",o(v,"red",c),u){document.querySelector(".refreshButton.show .tc-refresh-icon").click();continue}return}o("Get result...","red",c);const k=await g(s,E.taskId,30);if(!k||k.errorDescription){if(o(k?k.errorDescription:"No result from API","red",c),u){document.querySelector(".refreshButton.show .tc-refresh-icon").click(),await r(1e3);continue}return}const S=k.objects,C=e.getBoundingClientRect(),T=C.width,A=C.height,I=3,N=T/I,q=A/2,M=e=>{const t=e%I,n=Math.floor(e/I);return{x:C.left+t*N+N/2,y:C.top+n*q+q/2}};for(let t=0;t<S.length;t++){t>0&&await r(50+Math.floor(51*Math.random()));const n=M(S[t]);await h(e,n.x,n.y)}await r(1e3),a(document.querySelector("#verifyBtn"));if(await new Promise((e=>{let t=!1;const n=document.querySelector("#tcWrap"),r=n?.parentElement;if(!r)return void e(!1);const o=new MutationObserver((n=>{for(const a of n)"attributes"===a.type&&"aria-hidden"===a.attributeName&&"true"===r.getAttribute("aria-hidden")&&(t||(t=!0,o.disconnect(),e(!1)))}));o.observe(r,{attributes:!0,attributeFilter:["aria-hidden"]}),setTimeout((()=>{t||(t=!0,o.disconnect(),e(!0))}),4500)}))){if(u)continue;return}return}}async function y(){for(;;){let y,w;for(let e=0;e<30&&(e>0&&await r(500),y=document.querySelector(".tc-captcha .tc-bg-img.unselectable"),w=document.querySelector(".tc-title .tc-instruction-icon img"),null===y||null===w);e++);if(!y||!w)return;let h=document.querySelector(".tc-captcha");o("Captcha tc-captcha","red",h);let b=null,E=null;for(let e=0;e<20;e++){e>0&&await r(500);const t=getComputedStyle(y);b=t.backgroundImage.match(/url\(["']?(.*?)["']?\)/)?.[1];const n=document.querySelector(".tc-title .tc-instruction-icon img");if(E=n?n.src:null,b&&"none"!==b&&E)break}if(!b||"none"===b)return;if(!E){if(u){await r(500);continue}return}let v="",k="";for(let e=0;e<20;e++)if(e>0&&await r(500),v=await t("TENCENT","createImageBase64",{url:b}),k=await t("TENCENT","createImageBase64",{url:E}),v&&k&&f!==v){f=v;break}const S={type:"TencentIconWebTask",imageBase64:v,anchor:k,widthView:y.clientWidth,heightView:y.clientHeight},C=JSON.stringify({clientKey:s,task:S});o("Create task...","red",h);const T=await i(C);let A="";if(!T||T.error||T.message){if(A=T.error?T.errorDescription:T.message?T.message:"No response createTask",o(A,"red",h),u){document.querySelector(".refreshButton.show .tc-refresh-icon").click();continue}return}o("Get result...","red",h);const I=await g(s,T.taskId,30);if(!I||I.errorDescription){if(o(I?I.errorDescription:"No result from API","red",h),u){document.querySelector(".refreshButton.show .tc-refresh-icon").click(),await r(1e3);continue}return}for(const t of I.points){const o=parseInt(t.x,10),a=parseInt(t.y,10);n=o,c=a,l=void 0,d=void 0,m=void 0,p=void 0,l=(e=y).getBoundingClientRect(),d=l.left+n,m=l.top+c,p=new MouseEvent("click",{bubbles:!0,clientX:d,clientY:m}),e.dispatchEvent(p),await r(200)}await r(1e3),a(document.querySelector("#verifyBtn"));if(await new Promise((e=>{let t=!1;const n=document.querySelector("#tcWrap"),r=n?.parentElement;if(!r)return void e(!1);const o=new MutationObserver((n=>{for(const a of n)"attributes"===a.type&&"aria-hidden"===a.attributeName&&"true"===r.getAttribute("aria-hidden")&&(t||(t=!0,o.disconnect(),e(!1)))}));o.observe(r,{attributes:!0,attributeFilter:["aria-hidden"]}),setTimeout((()=>{t||(t=!0,o.disconnect(),e(!0))}),4500)}))){if(u)continue;return}return}var e,n,c,l,d,m,p}async function w(e,t){const n=e.getBoundingClientRect(),r=n.left+n.width/2,o=n.top+n.height/2,a=r+t,i={bubbles:!0,cancelable:!0,clientX:r,clientY:o,pointerType:"mouse",buttons:0};for(const t of[e,document,window])t.dispatchEvent(new PointerEvent("pointerover",i)),t.dispatchEvent(new PointerEvent("pointerenter",i)),t.dispatchEvent(new MouseEvent("mouseover",i)),t.dispatchEvent(new MouseEvent("mouseenter",i));await new Promise((e=>setTimeout(e,300)));const c={...i,buttons:1};for(const t of[e,document,window])t.dispatchEvent(new PointerEvent("pointerdown",c)),t.dispatchEvent(new MouseEvent("mousedown",c));const s=12+Math.floor(6*Math.random());for(let n=0;n<=s;n++){const a={bubbles:!0,cancelable:!0,clientX:r+t*(n/s)+2*(Math.random()-.5),clientY:o+3*(Math.random()-.5),pointerType:"mouse",buttons:1};for(const t of[e,document,window])t.dispatchEvent(new PointerEvent("pointermove",a)),t.dispatchEvent(new MouseEvent("mousemove",a));await new Promise((e=>setTimeout(e,35+25*Math.random())))}const l={bubbles:!0,cancelable:!0,clientX:a,clientY:o,pointerType:"mouse",buttons:0};for(const t of[e,document,window])t.dispatchEvent(new PointerEvent("pointerup",l)),t.dispatchEvent(new MouseEvent("mouseup",l))}async function h(e,t,n){if(!e)return;const o=t+5*(Math.random()-.5),a=n+5*(Math.random()-.5),i=["mouseover","mouseenter","pointerover","pointerenter","mousemove","pointermove"];for(const t of i)e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,clientX:o,clientY:a})),await r(15+20*Math.random());const c=["pointerdown","mousedown","mouseup","click"];for(const t of c)e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,clientX:o,clientY:a})),await r(25+30*Math.random())}async function g(e,n,r){const o=JSON.stringify({clientKey:e,taskId:n});try{const e=await t("SOURCE","getTaskResult",{data:o,timeWait:r});return e?"fail"===e.status?{errorDescription:e.errorDescription}:e.solution?e.solution:e.type?e:null:null}catch(e){return null}}})();