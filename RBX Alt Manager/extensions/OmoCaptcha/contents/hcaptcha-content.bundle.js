(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},APP_ID:{key:"appId",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:25}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},SLIDE_ALL:{key:"slide_all",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},HCAPTCHA:{key:"hcaptcha",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},CLOUDFLARE:{key:"cloudflare",defaultValue:{delayClick:2e3,isActive:!0}},TENCENT:{key:"tencent",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}}};async function t(e,t,a){const n="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((i,o)=>{n.sendMessage({source:e,type:t,data:a},(e=>{n.lastError?o(new Error(`Error sending message: ${n.lastError.message}`)):i(e)}))}))}catch(e){throw e}}const a=async(e,t)=>{const a="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,n="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const i=await a.get([e]);if(n.lastError)throw new Error(`Error retrieving ${e}: ${n.lastError.message}`);return null!=i[e]?i[e]:t}catch(e){throw e}};Promise.resolve();async function n(e){return new Promise((t=>setTimeout(t,e)))}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n="1.5.6";let i=document.getElementById("captcha-message");i||(i=document.createElement("div"),i.id="captcha-message",i.style.zIndex="99999999",i.style.padding="3px 3px",i.style.borderRadius="3px",i.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.2)",i.style.fontSize="10px",i.style.fontWeight="600",i.style.fontFamily="Arial, sans-serif",i.style.textAlign="center",i.style.whiteSpace="nowrap",i.style.color="white",i.style.top="1px",a&&a.parentElement?(i.style.position="absolute",i.style.left="2px",a.parentElement.appendChild(i)):(i.style.position="fixed",i.style.left="1px",document.body.appendChild(i)));const o={success:"linear-gradient(90deg, #6a11cb,rgb(191, 37, 252))",error:"linear-gradient(90deg, #ff416c, #ff4b2b)",warning:"linear-gradient(90deg, #ff9a44, #fc6076)",info:"linear-gradient(90deg, #17a2b8, #138496)"};i.innerText=`[OMOcaptcha-${n}] `+e,i.style.background=o[t]||o.success,i.style.display="block"}async function o(e){try{const a=await t("SOURCE","createTask",e);return a||""}catch(e){return""}}async function r(e,a,n){const i=JSON.stringify({clientKey:e,taskId:a});try{const e=await t("SOURCE","getTaskResult",{data:i,timeWait:n});return e?"fail"===e.status?{errorDescription:e.errorDescription}:e.solution?e.solution:e.type?e:null:null}catch(e){return null}}async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(!e)return;const a=e.getBoundingClientRect(),i=Math.floor(3+3*Math.random()),o=t/i;for(let t=0;t<i;t++){const t=a.left+Math.random()*a.width,i=a.top+Math.random()*a.height;e.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,cancelable:!0,view:window,clientX:t,clientY:i})),await n(o)}}let l,c,d,u,h;const p="1.5.6";let m="";async function f(){l=await a(e.POWER_ON.key,e.POWER_ON.defaultValue),c=await a(e.API_KEY.key,e.API_KEY.defaultValue);const t=await a(e.HCAPTCHA.key,e.HCAPTCHA.defaultValue);d=t.delayClick||500,u=t.loop||!1,h=t.isActive||!1}const g={observer:null,async solve(){if(await f(),l&&h&&c&&"YOUR_CLIEN_KEY"!==c){await n(Math.floor(501*Math.random())+2e3);try{const e=document.querySelector("#checkbox");if(!e)return;(e=>{const t=e.getBoundingClientRect(),a=t.left+t.width/2,n=t.top+t.height/2;["mouseover","mouseenter","pointerover","pointerenter","mousemove","pointermove"].forEach((t=>{e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,clientX:a,clientY:n}))})),["pointerdown","mousedown","mouseup","click"].forEach((t=>{e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,clientX:a,clientY:n}))})),window.parent.postMessage({type:"checkboxStateHcaptcha",state:!0},"*")})(e),this.observer=new MutationObserver((async t=>{for(const a of t)if("attributes"===a.type&&"aria-checked"===a.attributeName){const t="true"===e.getAttribute("aria-checked");window.parent.postMessage({type:"checkboxStateHcaptcha",state:t},"*")}})),this.observer.observe(e,{attributes:!0,attributeFilter:["aria-checked"]})}catch(e){}}}};function w(e){if(!e)return"";const t={і:"i",Ӏ:"i",Ι:"I",ι:"i",ı:"i",ϳ:"j",ο:"o",Ο:"O",ɵ:"o",օ:"o",у:"y",Υ:"Y",υ:"y",с:"c",ϲ:"c",С:"C",е:"e",є:"e",ɛ:"e",℮:"e",а:"a",ɑ:"a",Α:"A",α:"a",ԁ:"d",ℓ:"l",ӏ:"l",ⅼ:"l",ո:"n",ʀ:"r",г:"r",т:"t",һ:"h",м:"m",κ:"k",р:"p",х:"x",Χ:"X",ɡ:"g",ѕ:"s",Ѕ:"S",զ:"q"};return e.split("").map((e=>t[e]||e)).join("").toLowerCase().trim()}let y=!1;const v={observer:null,checkboxChecked:!1,firstImageBase64:"",reportManager:{resolvedTaskIds:[],addTaskId(e){this.resolvedTaskIds.push(e)},async sendReport(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0===this.resolvedTaskIds.length)return;const a={taskIds:this.resolvedTaskIds,result:e};try{await t("HCAPTCHA","reportTask",a)}catch(e){}finally{this.resolvedTaskIds=[]}},resetTaskIds(){this.resolvedTaskIds=[]}},initMessageListener(){window.addEventListener("message",(e=>{if("checkboxStateHcaptcha"===e.data.type)this.checkboxChecked=e.data.state,this.checkboxChecked&&!u&&this.observer&&this.observer.disconnect()}))},async solve(){if(await f(),!l||!h||!c||"YOUR_CLIEN_KEY"===c)return;const e=await(t="#display-language > div",a=5e3,new Promise((e=>{const n=document.querySelector(t);if(n)return e(n);const i=new MutationObserver(((a,n)=>{const i=document.querySelector(t);i&&(n.disconnect(),e(i))}));i.observe(document.body,{childList:!0,subtree:!0}),setTimeout((()=>{i.disconnect(),e(null)}),a)})));var t,a;if(e){for(let t=0;t<10;t++){if("EN"===e.textContent.trim())break;e.click(),await new Promise((e=>setTimeout(e,1500)));const t=document.querySelectorAll("#language-list .option span"),a=Array.from(t).find((e=>"English"===e.textContent.trim()));if(a){a.click();break}await n(1e3)}try{i("Check type captcha...","green");let e=0,t=0;for(;;)if(e>0||t>0?await n(250):await n(1e3),!y&&!this.checkboxChecked)try{this.findElement('.challenge-container canvas[role="img"]')?(e++,t=0,e>=3&&(await this.solveWithCanvas(),e=0)):this.findElement('.challenge-container [class="task-grid"]')?(t++,e=0,t>=3&&(await this.solveWithGrid(),t=0)):(e=0,t=0)}catch(e){}finally{y=!1}}catch(e){i(`Error solving HCAPTCHA: ${e.message}`,"red"),this.reportManager.resetTaskIds()}}},async solveWithCanvas(){if(!this.checkboxChecked&&!document.hidden)try{const e=document.querySelector(".challenge-container");await s(e),await n(100+50*Math.random()),y=!0,i("Solve Canvas...","red");let a=null,l=null;for(let e=0;e<3;e++){if(e>0){await n(500);if(!this.findElement('.challenge-container canvas[role="img"]'))return}let t=null,i=[...document.querySelectorAll(".prompt-text")].find((e=>"0"!==getComputedStyle(e).opacity));if(i&&(t=i.textContent.trim()),a=await this.getStableCanvasBase64(),!a)continue;let o=null;for(let e=0;e<10&&(e>0&&await n(200),o=[...document.querySelectorAll(".prompt-text")].find((e=>"0"!==getComputedStyle(e).opacity)),!(o&&o.textContent.trim().length>10));e++);if(o&&(l=o.textContent.trim(),!t||t===l))break}if(!a||!l)return i("Cannot get stable canvas image","red"),void await this.refresh();i("Get image...","red");let d=[];const h='[class="bounding-box-example"] [class="example-image"] [class="image"]',f='[class="challenge-example"] [class="image-wrapper"] [class="image"]';let g=[...document.querySelectorAll(h)].filter((e=>"0"!==getComputedStyle(e).opacity)).length?[...document.querySelectorAll(h)].filter((e=>"0"!==getComputedStyle(e).opacity)):[...document.querySelectorAll(f)].filter((e=>"0"!==getComputedStyle(e).opacity));for(const e of g){const a=window.getComputedStyle(e).backgroundImage.match(/url\(["']?(.*?)["']?\)/);if(a&&a[1]){const e=await t("HCAPTCHA","createImageBase64",{url:a[1]});e&&d.push(e)}}i("Create task...","red");let w={type:"HcaptchaImageTask",anchors:d,queries:Array.isArray(a)?a:[a],question:l,info:{version:p,pageUrl:m||""}};if(this.checkboxChecked)return;const v=JSON.stringify({clientKey:c,task:w}),b=await o(v);let k="";if(!b||b.error||b.message)return k=b.error?b.errorDescription:b.message?b.message:"No response createTask",i(k,"red"),u?void await this.refresh():void 0;this.reportManager.addTaskId(b.taskId),i("Get result...","red");const C=await r(c,b.taskId,30);if(!C||!C.type||C.errorDescription){return i(C?C.errorDescription:"No result from API","red"),await this.reportManager.sendReport(!1),void(u&&await this.refresh())}let E=C.type;i(`Action ${E}...`,"red"),"click"===E?await this.clickCanvas(C.coords):"drag"===E&&await this.dragCanvas(C.box),await this.next()}catch(e){i("solveWithCanvas function failed","red"),await this.reportManager.sendReport(!1),await this.refresh()}},getGridRect(){const e=document.querySelector(".challenge-header");return e?e.getBoundingClientRect().toJSON():null},getCanvasRect(){const e=document.querySelector('canvas[role="img"]');return e?e.getBoundingClientRect().toJSON():null},async getStableCanvasBase64(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas",o=null,r=null,s=null;if(s="canvas"===i?this.getCanvasRect():this.getGridRect(),!s)return null;let l=null;for(let e=0;e<30&&(l="canvas"===i?[...document.querySelectorAll(".prompt-text")].find((e=>"0"!==getComputedStyle(e).opacity)):document.querySelector('[class="prompt-text"]>span'),!(l&&l.textContent.trim().length>10));e++)await n(200);if(!l)return void await this.refresh();let c=l.textContent.trim(),d=5e4*window.devicePixelRatio*.45;if("click the object that moves differently"===w(c)||"please click on the shape that does not move"===w(c)||"find the object rotating in the opposite direction"===w(c)||"select the object with a unique motion pattern"===w(c)){let i=[];for(let o=0;o<3;o++){let r=null;for(let i=0;i<e;i++){const e=await t("HCAPTCHA","getCanvasBase64_screenshot",{rectCanvas:s});if(r=e?.base64||null,r){if(r.length>d)break;await n(a)}else await n(a)}if(!r||r.length<=d)return null;i.push(r),o<2&&await n(250)}return i}for(let i=0;i<e;i++){i>0&&await n(a);const l=await t("HCAPTCHA","getCanvasBase64_screenshot",{rectCanvas:s});if(!l.base64)continue;const c=l.base64;if(!(c.length<d)){if(c===o){r=c;break}i===e-1&&c.length>d&&(r=c),o=c}}return r},async solveWithGrid(){try{const e=document.querySelector(".challenge-container");let a;await s(e),y=!0,i("Solve Grid...","red");let l=[];for(let e=0;e<15;e++)if(e>0&&await n(200),l=[],a=document.querySelectorAll('[class="task-grid"] [class="task"] [class="task-image"] [class="image"]'),a.length>8){for(const e of a){const a=window.getComputedStyle(e).backgroundImage.match(/url\(["']?(.*?)["']?\)/);if(a&&a[1]){const e=await t("HCAPTCHA","createImageBase64",{url:a[1]});e&&l.push(e)}}if(l.length>8)break}if(!(l.length>8))return i("Failed to collect images, refreshing...","red"),void await this.refresh();let d=null;for(let e=0;e<10;e++){let e=document.querySelector('[class="prompt-text"]>span');if(e&&e.textContent.length>10){d=e.textContent;break}await n(200)}if(!d)return void await this.refresh();let h=[],f=document.querySelectorAll(".challenge-prompt .example-wrapper .challenge-example .image .image").length?document.querySelectorAll(".challenge-prompt .example-wrapper .challenge-example .image .image"):document.querySelectorAll(".challenge-prompt .example-wrapper .challenge-example .image");if(f.length>0)for(const e of f){const a=window.getComputedStyle(e).backgroundImage.match(/url\(["']?(.*?)["']?\)/);if(a&&a[1]){const e=await t("HCAPTCHA","createImageBase64",{url:a[1]});e&&h.push(e)}}if(h.length>0&&h[0]&&h[0].length>2e4){let e=await this.getStableCanvasBase64(40,250,"grid");if(!e)return i("Cannot get stable canvas image","red"),void await this.refresh();h=Array.isArray(e)?e:[e]}let g={type:"HcaptchaImageTask",anchors:h,queries:l,question:d,info:{version:p,pageUrl:m||""}};if(this.checkboxChecked)return;i("Create task...","red");const w=JSON.stringify({clientKey:c,task:g}),v=await o(w);let b="";if(!v||v.error||v.message)return b=v.error?v.errorDescription:v.message?v.message:"No response createTask",i(b,"red"),u?void await this.refresh():void 0;this.reportManager.addTaskId(v.taskId),i("Get result...","red");const k=await r(c,v.taskId,30);if(!k||!k.objects||k.errorDescription){return i(k?k.errorDescription:"No result from API","red"),await this.reportManager.sendReport(!1),void(u&&await this.refresh())}const C=k.objects;for(let e=0;e<C.length;e++)e>0&&await n(50+Math.floor(51*Math.random())),await this.simulateElementClick(a[C[e]]);await this.next()}catch(e){i("solveWithGrid function failed","red"),await this.reportManager.sendReport(!1),await this.refresh()}},async refresh(){document.querySelector('body:not([aria-hidden="true"]) [class="refresh button"]').click(),await n(2e3)},async next(){let e=document.querySelector('[class="button-submit button"]'),t=e.textContent;if("Verify"!==t&&await n(500),e.click(),i("Clicked submit","red"),"Verify"===t)for(let e=0;e<10;e++){if(this.findElement('[class="display-error"][style*="opacity: 1"]')){await this.reportManager.sendReport(!1),i("Solving failed","red"),await n(1500);break}if(this.checkboxChecked){i("Successfully solved captcha","green");break}i("Solving...","red"),await n(500)}},findElement:e=>!!document.querySelector(e),async extractImageUrlFromStyle(e){try{const t=(await e.evaluate((e=>e.style.background))).match(/url\(["']?(.*?)["']?\)/);if(t)return t[1]}catch(e){}return null},async simulateElementClick(e){if(!e)return;const t=e.getBoundingClientRect(),a=t.left+t.width*(.3+.4*Math.random()),i=t.top+t.height*(.3+.4*Math.random()),o=["mouseover","mouseenter","pointerover","pointerenter","mousemove","pointermove"];for(const t of o)e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,clientX:a,clientY:i})),await n(15+20*Math.random());const r=["pointerdown","mousedown","mouseup","click"];for(const t of r)e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,clientX:a,clientY:i})),await n(25+30*Math.random())},async clickCanvas(e){let t=document.querySelector('canvas[role="img"]');for(let a=0;a<e.length;a++){a>0&&await n(50+Math.floor(51*Math.random()));const[i,o]=e[a];await this.simulateClick(t,i,o)}},async simulateClick(e,t,a){if(!e)return;const i=e.getBoundingClientRect(),o=window.devicePixelRatio||1,r=i.left+t/o,s=i.top+a/o,l=e=>new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,clientX:r,clientY:s,buttons:"mousedown"===e||"mousemove"===e?1:0}),c=e=>new PointerEvent(e,{bubbles:!0,cancelable:!0,view:window,clientX:r,clientY:s,pointerId:1,pointerType:"mouse",isPrimary:!0,buttons:"pointerdown"===e||"pointermove"===e?1:0});e.focus&&(e.focus(),await n(10+20*Math.random()));const d=[{type:"pointerover",isPointer:!0},{type:"pointerenter",isPointer:!0},{type:"mouseover",isPointer:!1},{type:"mouseenter",isPointer:!1},{type:"pointermove",isPointer:!0},{type:"mousemove",isPointer:!1},{type:"pointerdown",isPointer:!0},{type:"mousedown",isPointer:!1},{type:"pointerup",isPointer:!0},{type:"mouseup",isPointer:!1},{type:"click",isPointer:!1}];for(const{type:t,isPointer:a}of d){const i=a?c(t):l(t);e.dispatchEvent(i),await n(25+35*Math.random())}},async dragCanvas(e){let t=document.querySelector('canvas[role="img"]');for(let a=0;a<e.length;a++){a>0&&await n(50+Math.floor(51*Math.random()));const[i,o]=e[a].start,[r,s]=e[a].end;await this.simulateDrag(t,i,o,r,s)}},async simulateDrag(e,t,a,i,o){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30;const s=e.getBoundingClientRect(),l=window.devicePixelRatio||1,c=s.left+t/l,d=s.top+a/l,u=s.left+i/l,h=s.top+o/l,p=function(e,t,a){return new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,clientX:t,clientY:a,buttons:arguments.length>3&&void 0!==arguments[3]?arguments[3]:0})},m=function(e,t,a){return new PointerEvent(e,{bubbles:!0,cancelable:!0,view:window,clientX:t,clientY:a,pointerId:1,pointerType:"mouse",isPrimary:!0,buttons:arguments.length>3&&void 0!==arguments[3]?arguments[3]:0})},f=e=>1-Math.pow(1-e,3),g=e=>e<.1||e>.9?0:.6*(Math.random()-.5);e.dispatchEvent(m("pointerover",c,d)),e.dispatchEvent(m("pointerenter",c,d)),e.dispatchEvent(p("mouseover",c,d)),e.dispatchEvent(p("mouseenter",c,d)),await n(15+25*Math.random()),e.dispatchEvent(m("pointermove",c,d)),e.dispatchEvent(p("mousemove",c,d)),await n(10+20*Math.random()),e.dispatchEvent(m("pointerdown",c,d,1)),e.dispatchEvent(p("mousedown",c,d,1)),await n(20+30*Math.random());for(let t=1;t<=r;t++){const a=t/r,i=f(a),o=d+(h-d)*i,s=c+(u-c)*i+g(a),l=o+g(a);e.dispatchEvent(m("pointermove",s,l,1)),e.dispatchEvent(p("mousemove",s,l,1)),await n(6+18*Math.random())}e.dispatchEvent(m("pointermove",u,h,1)),e.dispatchEvent(p("mousemove",u,h,1)),await n(10+15*Math.random()),e.dispatchEvent(m("pointerup",u,h)),e.dispatchEvent(p("mouseup",u,h)),await n(15+25*Math.random()),e.dispatchEvent(p("mouseleave",u,h)),e.dispatchEvent(m("pointerleave",u,h))}};v.initMessageListener(),(async()=>{if(await f(),await async function(){try{const e=await t("HCAPTCHA","getURL");e&&(m=e)}catch(e){}}(),c&&"YOUR_CLIEN_KEY"!==c){if(h&&l){const e=window.location.href.includes("frame=checkbox"),t=window.location.href.includes("frame=challenge");e&&!t?await g.solve():t&&await v.solve()}}else i("Invalid or missing API KEY","red")})()})();