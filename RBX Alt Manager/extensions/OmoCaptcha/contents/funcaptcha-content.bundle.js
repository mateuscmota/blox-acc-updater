(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},APP_ID:{key:"appId",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:25}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},SLIDE_ALL:{key:"slide_all",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},HCAPTCHA:{key:"hcaptcha",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},CLOUDFLARE:{key:"cloudflare",defaultValue:{delayClick:2e3,isActive:!0}},TENCENT:{key:"tencent",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}}};async function t(e,t,r){const a="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((n,i)=>{a.sendMessage({source:e,type:t,data:r},(e=>{a.lastError?i(new Error(`Error sending message: ${a.lastError.message}`)):n(e)}))}))}catch(e){throw e}}const r=async(e,t)=>{const r="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,a="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const n=await r.get([e]);if(a.lastError)throw new Error(`Error retrieving ${e}: ${a.lastError.message}`);return null!=n[e]?n[e]:t}catch(e){throw e}};Promise.resolve();async function a(e){return new Promise((t=>setTimeout(t,e)))}function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a="1.5.6";let n=document.getElementById("captcha-message");n||(n=document.createElement("div"),n.id="captcha-message",n.style.zIndex="99999999",n.style.padding="3px 3px",n.style.borderRadius="3px",n.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.2)",n.style.fontSize="10px",n.style.fontWeight="600",n.style.fontFamily="Arial, sans-serif",n.style.textAlign="center",n.style.whiteSpace="nowrap",n.style.color="white",n.style.top="1px",r&&r.parentElement?(n.style.position="absolute",n.style.left="2px",r.parentElement.appendChild(n)):(n.style.position="fixed",n.style.left="1px",document.body.appendChild(n)));const i={success:"linear-gradient(90deg, #6a11cb,rgb(191, 37, 252))",error:"linear-gradient(90deg, #ff416c, #ff4b2b)",warning:"linear-gradient(90deg, #ff9a44, #fc6076)",info:"linear-gradient(90deg, #17a2b8, #138496)"};n.innerText=`[OMOcaptcha-${a}] `+e,n.style.background=i[t]||i.success,n.style.display="block"}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{timeout:5e3,maxRetries:3,typeImage:"png"};try{const{timeout:r,maxRetries:n,typeImage:i}=t,o=`image/${i||"png"}`,c={arkoselabs:"image/jpeg"};function s(e){for(const[t,r]of Object.entries(c))if(e.includes(t))return r;return o}if(e instanceof HTMLCanvasElement||e.tagName&&"CANVAS"===e.tagName.toUpperCase())try{if(0===e.width||0===e.height)return"";const l=e.getBoundingClientRect(),u=l.width,d=l.height,f=document.createElement("canvas");f.width=u,f.height=d;f.getContext("2d").drawImage(e,0,0,u,d);const h=f.toDataURL(o).split(",")[1];return h||""}catch(m){return""}if(e instanceof Element)try{const y=e.src;if(y&&y.startsWith("data:image/")){const p=y.split(",")[1];return p||""}e=y||""}catch(g){return""}if("string"==typeof e&&e.startsWith("blob:"))try{return await new Promise((t=>{const r=new Image;r.setAttribute("crossOrigin","anonymous");const a=setTimeout((()=>{t("")}),1e3);r.onload=function(){clearTimeout(a);try{const r=document.createElement("canvas");r.width=this.naturalWidth,r.height=this.naturalHeight;r.getContext("2d").drawImage(this,0,0);const a=s(e);r.toBlob((e=>{if(!e)return void t("");const r=new FileReader;r.onloadend=()=>{const e=r.result.split(",")[1];t(e)},r.onerror=()=>t(""),r.readAsDataURL(e)}),a)}catch(e){t("")}},r.onerror=()=>{clearTimeout(a),t("")},r.src=e}))}catch(w){return""}if("string"==typeof e)try{for(let b=0;b<n;b++)try{const v=new AbortController,k=setTimeout((()=>v.abort()),r),C=await fetch(e,{signal:v.signal});if(clearTimeout(k),!C.ok)throw new Error(`HTTP error ${C.status}`);const E=await C.blob();return await new Promise(((e,t)=>{const r=new FileReader;r.onloadend=()=>e(r.result.split(",")[1]),r.onerror=()=>t(new Error("Failed to read blob as base64")),r.readAsDataURL(E)}))}catch(A){if(b===n-1)return"";await a(500)}}catch(x){return""}return""}catch(S){return""}}function o(e){["pointerdown","mousedown","mouseup","click"].forEach((function(t){e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window}))}))}let c,s,l,u,d,f;async function h(){c=await r(e.POWER_ON.key,e.POWER_ON.defaultValue),s=await r(e.API_KEY.key,e.API_KEY.defaultValue);const t=await r(e.FUNCAPTCHA.key,e.FUNCAPTCHA.defaultValue);l=t.delayClick,u=t.loop,d=t.isActive,f=t.maxImageCaptcha}let m=!1,y=[];async function p(){n("captchaClickImage1","green");let e=A(".challenge-instructions-container");if(!e)return;const t=()=>{o(document.querySelector('[class*="restart-button"]'))};e=e.trim(),l<1e3&&(l=1e3);let r="";for(let o=0;o<500;o++){if(o>0){if(await a(l),C(['div[class*="tile-game-fail box screen"]','div[class*="match-game-fail box screen"]']))return u&&(n("Restart button...","red"),t()),void n("Failed to solve captcha","red");if(C(['div[class*="error box screen"]']))return u&&document.querySelector('div[class*="error box screen"] button').click(),void n("Failed to solve captcha","red");if(C(['div[class*="victory box screen"]']))return void n("Successfully solved captcha","green")}n("Get image...","red");const c=await b(r);if(!c)continue;r=c;const s=await i(r);if(!s)return n("Failed to fetch image base64 for URL","red"),void(u&&t());let d=null;for(let r=0;r<3;r++){const a=await v(s,e,30);if(2===r&&(!a||a.errorDescription))return n(a?.errorDescription||"No task result","red"),void(u&&(n("Restart button...","red"),t()));if(a&&a.result){d=parseInt(a.result.index,10);break}}n("Clicking...","red"),document.querySelector('button[aria-label*="Image '+d+'"]').click()}}async function g(){n("captchaClickImage2","green");let e=A("#game_children_text");if(e){e=e.trim(),e.endsWith(".")&&(e=e.slice(0,-1)),l<1e3&&(l=1e3);for(let t=0;t<500;t++){if(t>0){await a(l);const e=await k(['div[class*="error box screen"] button',"#wrong_children_button"],1);if(e)return u&&e.click(),void n("Failed to solve captcha","red");if(E('[id="victoryScreen"]'))return void n("Successfully solved captcha","green")}n("Get image...","red");const r=document.querySelector("#game_challengeItem_image");if(!r)continue;const o=await i(r,{timeout:5e3,maxRetries:3});if(!o)return n("No imageBase64","green"),void(u&&document.querySelector('a[aria-label="Start over with a different challenge" i]').click());const c=await v(o,e,20);if(!c||c.errorDescription)return n(c?.errorDescription||"No task result","red"),void(u&&document.querySelector('a[aria-label="Start over with a different challenge" i]').click());if("Server 500"===c.result)continue;const s=c.result.index;n("Clicking...","red"),await k(['[aria-label*="Image '+s+'" i]'],1e3)&&document.querySelector('[aria-label*="Image '+s+'" i]').click()}}}async function w(){n("captchaClickButton","green");const e=()=>{o(document.querySelector('[class*="restart-button"]'))};let t=A(".match-game .text");if(!t)return;const r=t.match(/\(.*\b(\d+)\)$/);if(r){if(parseInt(r[1],10)>f)return void n(`Image > ${f}, stop function`,"red")}t=t.split("(")[0].trim(),t.endsWith(".")&&(t=t.slice(0,-1));let c="";for(let r=0;r<500;r++){if(r>0){if(await a(l),C(['div[class*="tile-game-fail box screen"]','div[class*="match-game-fail box screen"]']))return u&&(n("Restart captcha","red"),e()),await S(!1),void n("Failed to solve captcha","red");if(C(['div[class*="error box screen"]']))return u&&document.querySelector('div[class*="error box screen"] button').click(),await S(!1),void n("Failed to solve captcha","red");if(C(['div[class*="victory box screen"]']))return void n("Successfully solved captcha","green")}n("Get image...","red");const s=await b(c);if(!s)continue;c=s;const d=await i(c);if(!d)return n("No imageBase64","red"),void(u&&e());let f=null;for(let r=0;r<3;r++){const a=await v(d,t,30);if(2===r&&(!a||a.errorDescription))return n(a?.errorDescription||"No task result","red"),void(u&&e());if(a&&a.result){f=parseInt(a.result.index,10);break}}if(!f)return;if(f-=1,f>30)return u&&e(),void n("Failed to solve captcha","red");n(`Click next (${f})...`,"red");for(let e=0;e<f;e++)e>0&&await a(l),o(document.querySelector(".right-arrow"));n("Click submit...","red"),x(document.querySelector('div[class*="match-game box screen"] button'))}}async function b(e){const t=document.querySelector("body").innerHTML.match(/blob:https:\/\/(?:.*?arkoselabs.*?\.com|arks-client\.[a-zA-Z0-9.-]+|.*?digitalocean\.com)\/[a-f0-9-]{36}/i);return t?e===t[0]?(await a(500),null):t[0]:(await a(500),null)}async function v(e,r,a){try{n("Creating task...","green");const i=JSON.stringify({clientKey:s,task:{type:"FuncaptchaImageTask",imageBase64:e,other:r}}),o=await async function(e){try{return await t("SOURCE","createTask",e)||""}catch(e){return""}}(i);if(!o||o.error||!o.taskId)return o.error?{errorDescription:o.errorDescription}:(n("No taskId","red"),null);const c=o.taskId;y.push(c),n("Get result...","green");const l=await async function(e,r,a){const n=JSON.stringify({clientKey:e,taskId:r});try{const e=await t("SOURCE","getTaskResult",{data:n,timeWait:a});return e?"fail"===e.status?{errorDescription:e.errorDescription}:e.solution?e.solution:e.type?e:null:null}catch(e){return null}}(s,c,a);return!l||l.errorDescription?l.errorDescription?{errorDescription:l.errorDescription}:null:{result:l}}catch(e){return null}}async function k(e,t){const r=Math.ceil(t/1e3);for(let t=0;t<r;t++){await new Promise((e=>setTimeout(e,1e3)));for(const t of e){const e=document.querySelector(t);if(e)return e}}return null}function C(e){for(const t of e){const e=document.querySelector(t);if(e)return e}return null}function E(e){return!!document.querySelector(e)}function A(e){const t=document.querySelector(e);return t?t.textContent.trim():null}function x(e){if(!e)return;if(!function(e){const t=e.getBoundingClientRect();return t.width>0&&t.height>0}(e))return;const t=e.getBoundingClientRect(),r=t.left+t.width/2,a=t.top+t.height/2,n=Math.random()*window.innerWidth/2,i=Math.random()*window.innerHeight/2,c=Math.floor(20*Math.random())+10;!function t(o){if(o>=c)return;const s=(l=o/c,1-Math.pow(1-l,3));var l;const u=n+(r-n)*s,d=i+(a-i)*s,f=5*(Math.random()-.5),h=5*(Math.random()-.5),m=new MouseEvent("mousemove",{bubbles:!0,clientX:u+f,clientY:d+h});if(document.dispatchEvent(m),0===o){const t=new MouseEvent("mouseover",{bubbles:!0,clientX:u+f,clientY:d+h});e.dispatchEvent(t)}const y=30*Math.random()+20;setTimeout((()=>t(o+1)),y)}(0),o(e)}async function S(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0===y.length)return;const r={taskIds:y,result:e};try{await t("FUNCAPTCHA","reportTask",r)}catch(e){}finally{y=[]}}new class{constructor(e,t){this.selectors=e,this.callback=t,this.processedNodes=new Set,this.observer=new MutationObserver(this.handleMutation.bind(this)),this.startObserving()}startObserving(){this.observer.observe(document.body,{childList:!0,subtree:!0})}stopObserving(){this.observer.disconnect()}async handleMutation(e){if(c&&d)for(const t of e){const e=Array.from(t.addedNodes);for(const t of e)if(t.nodeType===Node.ELEMENT_NODE)for(const e of this.selectors)if(t.matches(e)&&!this.processedNodes.has(t))this.processedNodes.add(t),await this.callback(e,[t]);else{const r=Array.from(t.querySelectorAll(e));for(const t of r)this.processedNodes.has(t)||(this.processedNodes.add(t),await this.callback(e,r))}}}}(['button[aria-describedby="descriptionVerify"]','p[aria-label*="Working, please wait" i]','button[data-theme="home.verifyButton"]',".error .button","#wrongTimeout_children_button",'button[id="home_children_button"]'],(async(e,t)=>{if(await h(),!m&&c&&d&&s&&"YOUR_CLIEN_KEY"!==s)try{m=!0,await a(1e3);const e=await k(['div[class*="error box screen"] button',"#wrong_children_button"],1e3);if(e)return void(u&&e.click());for(let e=0;e<10;e++){const e=await k(['button[data-theme="home.verifyButton"]','button[id="home_children_button"]','button[aria-describedby="descriptionVerify"]'],1e3);if(e&&(o(e),y=[]),E(".challenge-instructions-container"))await p();else if(E(".match-game .text"))await w();else{if(!E("#game_children_text"))continue;await g()}}}catch(e){}finally{m=!1}})),(async()=>{await h()})()})();